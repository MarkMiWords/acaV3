<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>The Sovereign Forge</title>
  <link rel="stylesheet" href="/styles.css">
  <link rel="manifest" href="/manifest.json">
</head>
<body>
  <!-- Main Workspace Container -->
  <div class="forge-workspace">

    <!-- Left Panel: Navigator -->
    <aside class="navigator-panel" id="navigator">
      <div class="navigator-brand">
        <span class="brand-title">The Forge</span>
        <span class="brand-version">VT.5</span>
      </div>

      <div class="navigator-actions">
        <button id="home-btn" class="nav-action-btn">Home</button>
        <button id="live-link-btn" class="nav-action-btn nav-btn-live-link">
          <span class="live-link-dot"></span>
          Live Link
        </button>
        <button id="new-sheet-btn" class="nav-action-btn nav-btn-primary">New WRAP Sheet</button>
      </div>

      <div class="nav-section currently-editing">
        <span class="nav-label">Currently Editing:</span>
        <span class="nav-editing-title" id="current-editing-title">Untitled Sheet</span>
      </div>

      <div class="sheet-list-container">
        <ul id="sheet-list" class="sheet-list">
          <!-- Sheets will be dynamically inserted here -->
        </ul>
      </div>

      <div class="navigator-footer">
        <button id="save-to-vault-btn" class="nav-action-btn nav-btn-vault">Save to Vault</button>
        <div class="nav-footer-links">
          <a href="/vault.html" class="nav-footer-link">The Vault</a>
          <a href="/profile.html" class="nav-footer-link">WRAP Profile</a>
        </div>
      </div>
    </aside>

    <!-- Resizer between Navigator and Sheet -->
    <div class="resizer" data-resizer="left"></div>

    <!-- Center Panel: Sheet Editor with WRAP Hub -->
    <main class="sheet-panel" id="sheet-panel">
      <!-- WRAP Hub -->
      <div class="wrap-hub">
        <span class="wrap-hub-label">WRAP</span>
        <div class="wrap-hub-buttons">
          <div class="wrap-btn-group">
            <button class="wrap-hub-btn active" data-wrap="write">
              <span class="wrap-letter">W</span>rite
              <span class="wrap-arrow">&#9662;</span>
            </button>
            <div class="wrap-dropdown" id="dropdown-write">
              <button class="wrap-dropdown-item" id="import-text-btn">
                <span class="dropdown-item-title">Import Text</span>
                <span class="dropdown-item-desc">Paste or upload text into the sheet</span>
              </button>
              <button class="wrap-dropdown-item" id="import-sheet-btn">
                <span class="dropdown-item-title">Import Sheet</span>
                <span class="dropdown-item-desc">Duplicate an existing sheet into workspace</span>
              </button>
              <div class="dropdown-divider"></div>
              <button class="wrap-dropdown-item disabled" disabled>
                <span class="dropdown-item-title">Dictation</span>
                <span class="dropdown-item-desc">Speech to text — pure transcription</span>
              </button>
              <button class="wrap-dropdown-item" id="poetry-mode-btn">
                <span class="dropdown-item-title">Poetry Mode</span>
                <span class="dropdown-item-desc">Preserve line breaks, minimal structure</span>
              </button>
            </div>
          </div>
          <div class="wrap-btn-group">
            <button class="wrap-hub-btn" data-wrap="revise">
              <span class="wrap-letter">R</span>evise
              <span class="wrap-arrow">&#9662;</span>
            </button>
            <div class="wrap-dropdown" id="dropdown-revise">
              <button id="rinse-btn" class="wrap-dropdown-item">
                <span class="dropdown-item-title">Rinse</span>
                <span class="dropdown-item-desc">Surface clean — spacing, punctuation, typos</span>
              </button>
              <button id="wash-btn" class="wrap-dropdown-item">
                <span class="dropdown-item-title">Wash</span>
                <span class="dropdown-item-desc">Clarity — paragraphs, readability, repetition</span>
              </button>
              <button id="scrub-btn" class="wrap-dropdown-item disabled" disabled>
                <span class="dropdown-item-title">Scrub</span>
                <span class="dropdown-item-desc">Structure — order, transitions, trimming</span>
              </button>
              <div class="dropdown-divider"></div>
              <button id="rinse-wipe-btn" class="wrap-dropdown-item disabled" disabled>
                <span class="dropdown-item-title">Rinse &amp; Wipe</span>
                <span class="dropdown-item-desc">Restore original wording, remove AI suggestions</span>
              </button>
            </div>
          </div>
          <div class="wrap-btn-group">
            <button class="wrap-hub-btn" data-wrap="articulate">
              <span class="wrap-letter">A</span>rticulate
              <span class="wrap-arrow">&#9662;</span>
            </button>
            <div class="wrap-dropdown" id="dropdown-articulate">
              <button id="read-aloud-btn" class="wrap-dropdown-item disabled" disabled>
                <span class="dropdown-item-title">Read Aloud</span>
                <span class="dropdown-item-desc">Hear your words — adjustable voice, speed, accent</span>
              </button>
              <button id="voice-clone-btn" class="wrap-dropdown-item disabled" disabled>
                <span class="dropdown-item-title">Voice Clone</span>
                <span class="dropdown-item-desc">Read a 45-second script to clone your voice</span>
              </button>
            </div>
          </div>
          <div class="wrap-btn-group">
            <button class="wrap-hub-btn" data-wrap="publish">
              <span class="wrap-letter">P</span>ublish
              <span class="wrap-arrow">&#9662;</span>
            </button>
            <div class="wrap-dropdown" id="dropdown-publish">
              <button class="wrap-dropdown-item disabled" disabled>
                <span class="dropdown-item-title">Prison Newspaper</span>
                <span class="dropdown-item-desc">Format for prison newspaper submission</span>
              </button>
              <button class="wrap-dropdown-item disabled" disabled>
                <span class="dropdown-item-title">Substack Story</span>
                <span class="dropdown-item-desc">Format for online publication</span>
              </button>
              <button class="wrap-dropdown-item disabled" disabled>
                <span class="dropdown-item-title">Book Manuscript</span>
                <span class="dropdown-item-desc">Compile sheets into manuscript format</span>
              </button>
              <button class="wrap-dropdown-item disabled" disabled>
                <span class="dropdown-item-title">Letter</span>
                <span class="dropdown-item-desc">Format as a personal letter</span>
              </button>
              <button class="wrap-dropdown-item disabled" disabled>
                <span class="dropdown-item-title">Voice Transcript</span>
                <span class="dropdown-item-desc">Export as spoken-word transcript</span>
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Sheet Editor (always visible) -->
      <div class="sheet-header">
        <input
          type="text"
          id="sheet-title"
          class="sheet-title-input"
          placeholder="Untitled Sheet"
          maxlength="100"
        >
      </div>

      <div
        id="sheet-editor"
        class="sheet-editor"
        contenteditable="true"
        spellcheck="true"
        data-placeholder="Start writing..."
      ></div>
    </main>

    <!-- Resizer between Sheet and WRAP Partner -->
    <div class="resizer" data-resizer="right"></div>

    <!-- Right Panel: WRAP Partner -->
    <aside class="partner-panel" id="partner-panel">
      <div class="partner-header">
        <h2>WRAP Partner</h2>
      </div>

      <!-- Help Modes -->
      <div class="partner-help-modes">
        <button class="help-mode-btn" data-mode="get-started">Get Started</button>
        <button class="help-mode-btn" data-mode="make-heading">Make a Heading</button>
        <button class="help-mode-btn" data-mode="research">Research a Topic</button>
        <button class="help-mode-btn" data-mode="guided">Guided Composition</button>
        <button class="help-mode-btn" data-mode="stories">Sheets to Stories</button>
      </div>

      <div id="partner-messages" class="partner-messages">
        <div class="partner-message system">
          <p>Welcome to The Forge. I'm here to help you express your words.</p>
        </div>
      </div>

      <div class="partner-input-area">
        <textarea
          id="partner-input"
          class="partner-input"
          placeholder="Ask for help or guidance..."
          rows="3"
        ></textarea>
        <button id="partner-send-btn" class="primary-btn">Send</button>
      </div>
    </aside>

  </div>

  <!-- Bottom Status Bar -->
  <div class="status-bar" id="status-bar">
    <span class="status-item" id="status-words">Words: 0</span>
    <span class="status-item" id="status-context">Context: Australia</span>
    <span class="status-item" id="status-vault">Vault: Active</span>
    <span class="status-item status-forge">The Sovereign Forge VT.5</span>
  </div>

  <!-- Word Limit Warning Modal -->
  <div id="word-warning-modal" class="modal hidden">
    <div class="modal-content">
      <h3>Approaching word limit</h3>
      <p>You're at <span id="warning-word-count">900</span> words. Consider wrapping up this scene or creating a new sheet.</p>
      <button id="close-warning-btn" class="primary-btn">Continue Writing</button>
      <button id="new-sheet-from-warning-btn" class="secondary-btn">Create New Sheet</button>
    </div>
  </div>

  <!-- Live Link Guardrails Modal -->
  <div id="live-link-modal" class="modal hidden">
    <div class="modal-content modal-guardrails">
      <h3>Forge Guardrails</h3>
      <p class="guardrails-intro">Before you meet Wrapp, you must acknowledge the tech and the truth.</p>

      <div class="guardrails-section">
        <span class="guardrails-number">01</span>
        <h4>Acoustic Link Latency Logic</h4>
        <p>The Live Link has a 3-second delay. Do not speak over Wrapp while she is processing.</p>
      </div>

      <div class="guardrails-section">
        <span class="guardrails-number"></span>
        <h4>Frequency Purity</h4>
        <p>Background noise threatens transcription integrity. Your frequency is your ink.</p>
      </div>

      <div class="guardrails-section">
        <span class="guardrails-number">02</span>
        <h4>Narrative Protocol</h4>
      </div>

      <div class="guardrails-section guardrails-sub">
        <h4>PII Responsibility</h4>
        <p>Redact real names of staff and victims. We provide pseudonyms, but you provide the final audit.</p>
      </div>

      <div class="guardrails-section guardrails-sub">
        <h4>Terminal Boundaries</h4>
        <p>Sexually explicit or gratuitously violent fetishism will terminate the link immediately.</p>
      </div>

      <div class="guardrails-accept">
        <label class="guardrails-checkbox-label">
          <input type="checkbox" id="guardrails-accept-check">
          <span>I accept the Acoustic Latency and Mic Protocols. I will protect identities and maintain a high integrity standard.</span>
        </label>
      </div>

      <button id="initialize-live-link-btn" class="primary-btn" disabled>Initialize Live Link</button>
      <button id="cancel-live-link-btn" class="secondary-btn">Cancel</button>
    </div>
  </div>

  <!-- Import Text Modal -->
  <div id="import-text-modal" class="modal hidden">
    <div class="modal-content modal-import-text">
      <h3>Import Text</h3>
      <p>Upload a file or paste text below.</p>

      <!-- File Upload -->
      <div class="import-file-zone" id="import-file-zone">
        <input type="file" id="import-file-input" class="import-file-hidden" accept=".txt,.docx,.doc,.html,.htm">
        <div class="import-file-label">
          <span class="import-file-icon">+</span>
          <span class="import-file-text">Choose file or drag here</span>
          <span class="import-file-formats">.txt, .docx, .html</span>
        </div>
      </div>
      <div class="import-file-name hidden" id="import-file-name">
        <span id="import-file-name-text"></span>
        <button id="import-file-clear" class="import-file-clear-btn">&times;</button>
      </div>

      <div class="import-divider">
        <span>or paste text</span>
      </div>

      <!-- Paste Area -->
      <textarea
        id="import-text-area"
        class="import-text-area"
        placeholder="Paste or type your text here..."
        rows="8"
      ></textarea>

      <div class="import-text-actions">
        <button id="import-append-btn" class="primary-btn">Append to Sheet</button>
        <button id="import-replace-btn" class="secondary-btn">Replace Sheet</button>
        <button id="import-cancel-btn" class="secondary-btn">Cancel</button>
      </div>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.8.0/mammoth.browser.min.js"></script>
  <script src="/app.js"></script>
</body>
</html>
